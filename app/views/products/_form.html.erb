<div class="col-md-6">
	<%= form_for @product do |f| %>
	<p>
		<%= f.label :title %><br>
		<%= f.text_field :title, :class => "form-control", :id => "text" %> <br>
	</p>
	<p>
		<%= f.label :body %><br>
		<%= f.text_area :body, :class => "form-control", :id => "textArea" %><br>
	</p>
	<p>
		<!-- %= f.label :file %> <br>
		<TODO %= f.attachment_field  :image, multiple: true, :id => "image_list", :onchange => "showFiles()", :style => "display: none;" %-->
		<!-- %= f.attachment_field  :image, multiple: true, :id => "image_list", :onchange => "showFiles()", :style => "display: none;" %>
		<div class="input-append input-group">
			<input id="file-display" class="btn form-control" type="text">
			<span class="input-group-btn">
				<button class="btn btn-primary" onclick="document.getElementById('image_list').click()" type="button">
					Choose image(s)
				</button>
			</span>
		</div--><br>
		 
		<%= f.attachment_field :threeD_model, multiple: false, :multipart => true, :onchange => "showStl()", :id => "stl_display", :style => "display: none;" %>
		<div class="input-append input-group">
			<input id="stl-display" class="btn form-control" type="text">
			<span class="input-group-btn">
				<button class="btn btn-primary" id="stl-button" type="button" onclick="document.getElementById('stl_display').click()">
					Choose .stl
				</button>
			</span>
		</div>
		<br>
	</p>
	<div class="btn btn-group">
		<%= submit_tag "Upload & Submit", :class => "btn btn-primary" %>
		<%= link_to "Cancel", root_path, :class => "btn btn-default" %>
	</div>
	<% end %>
</div>

<!-- TODO show the filename in the input field -->
<script type="text/javascript">
function showFiles() {
	var list = document.getElementById('image_list').files;
	var re= /(\.jpg|\.jpeg|\.bmp|\.gif|\.png)$/i;
	var txt = '';
	var invCount = 0;
	for (var i = 0; i<list.length; i++ ) {
		if(!re.exec(list.item(i).name)) {
			invCount++;
		} else {
			txt = txt.concat(list.item(i).name.split('\\').pop());
			if(i == list.length - 1) {
			} else {
				txt = txt.concat(', ');
			}
		}
	}
	if(invCount ==0) {
		document.getElementById('file-display').value = txt;
	} else {
		alert(invCount + " file(s) have invalid extensions for images.");
	}
}

function showStl() {
	var name = document.getElementById('stl_display').value.split('\\').pop();
	if(name.split('.').pop().toLowerCase() == 'stl') {
		document.getElementById('stl-display').value = name;
	} else {
		alert('Not an stl file');
	}
}
</script>
